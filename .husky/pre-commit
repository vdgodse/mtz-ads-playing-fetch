#!/usr/bin/env sh
set -e

staged_files=$(git diff --cached --name-only --diff-filter=ACMR)

if [ -z "$staged_files" ]; then
	exit 0
fi

printf '%s\n' "$staged_files" | while IFS= read -r file; do
	case "$file" in
		*.js|*.jsx|*.ts|*.tsx|*.json|*.css|*.scss|*.md|*.html|*.yml|*.yaml)
			npx --no-install oxfmt "$file" --write
			git add "$file"
			;;
	esac
done

npm run lint
